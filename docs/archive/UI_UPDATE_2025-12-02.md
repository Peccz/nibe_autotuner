# UI-uppdateringar 2025-12-02

## Ã–versikt
Uppdaterat anvÃ¤ndargrÃ¤nssnittet fÃ¶r att tydligt kommunicera att systemet nu fungerar som ett **rÃ¥dgivande system** istÃ¤llet fÃ¶r ett automatiskt justeringssystem, pÃ¥ grund av MyUplink API v2 begrÃ¤nsningar.

## Uppdateringar

### AI Agent-sidan (http://192.168.86.34:8502/ai-agent)

#### 1. Huvudtitel och beskrivning
**Innan:**
> ğŸ¤– AI-Agent
> Autonom optimering med Claude AI

**Efter:**
> ğŸ¤– AI-Agent
> Intelligent rÃ¥dgivning med Google Gemini AI

#### 2. Ny informationsbanner (hÃ¶gst upp)
Tillagt prominent lila banner som fÃ¶rklarar:
```
ğŸ’¡ RÃ¥dgivande System

AI-agenten analyserar vÃ¤rmepumpens prestanda och ger intelligenta
rekommendationer, men gÃ¶r inga automatiska Ã¤ndringar.

ğŸ“± Justera parametrar manuellt i vÃ¤rmepumpen (Meny 4.1) eller via
MyUplink-appen baserat pÃ¥ AI:ns rekommendationer.
```

#### 3. Automatiseringsschema
**Innan:**
- 06:00 - Morgonoptimering (ventilation & pump)
- 19:00 - KvÃ¤llsoptimering (ventilation & pump)
- "AI-agenten justerar bÃ¥de ventilation och pumpinstÃ¤llningar..."

**Efter:**
- 06:00 - Morgonanalys & rekommendationer
- 19:00 - KvÃ¤llsanalys & rekommendationer
- "AI-agenten analyserar systemet och genererar intelligenta rekommendationer..."

#### 4. MyUplink API begrÃ¤nsningar
Tillagt ny sektion som fÃ¶rklarar:
```
âš ï¸ OBS: MyUplink API-begrÃ¤nsningar

MyUplink API v2 fÃ¶r F730 stÃ¶djer inte automatisk justering av
vÃ¤rmeparametrar (vÃ¤rmekurva, offset, pumphastighet). Systemet
fungerar dÃ¤rfÃ¶r som ett rÃ¥dgivande system - AI:n analyserar
och rekommenderar, men du justerar manuellt i vÃ¤rmepumpen
eller via MyUplink-appen.
```

#### 5. Uppdaterade sÃ¤kerhetsregler
**Innan:**
- Max 1 justering per 48h per parameter
- Minst 70% konfidens krÃ¤vs fÃ¶r justeringar
- Inomhustemperatur hÃ¥lls alltid â‰¥20Â°C
- Minimum ventilation upprÃ¤tthÃ¥lls fÃ¶r luftkvalitet

**Efter:**
- Minst 70% konfidens krÃ¤vs fÃ¶r rekommendationer
- Inomhustemperatur hÃ¥lls alltid â‰¥20Â°C
- Rekommendationer inkluderar manuella justeringsinstruktioner
- Du har full kontroll Ã¶ver alla parameterjusteringar

### Dashboard-sidan (http://192.168.86.34:8502)

#### 1. Quick Action: HÃ¶j/SÃ¤nk temperatur
**Confirm-dialog innan:**
> Vill du hÃ¶ja kurvjusteringen med 1?

**Confirm-dialog efter:**
> FÃ¥ rekommendation att hÃ¶ja offset med 1?

**Alert-meddelande format:**
```
âœ… Rekommendation: Ã„ndra offset frÃ¥n -2 till -1

Rekommendation:
â€¢ Offset (47011): -2 â†’ -1
  HÃ¶j offset (+1)
  ğŸ“± Justera manuellt i vÃ¤rmepumpen: Meny 4.1.1

âš ï¸ MyUplink API stÃ¶djer inte automatisk justering.
Justera manuellt i vÃ¤rmepumpen eller via MyUplink-appen.
```

#### 2. Quick Action: Optimera fÃ¶r COP
**Confirm-dialog innan:**
> Optimera fÃ¶r maximal COP?
> Detta kan sÃ¤nka vÃ¤rmekurvan nÃ¥got fÃ¶r bÃ¤ttre effektivitet.

**Confirm-dialog efter:**
> FÃ¥ COP-optimeringsrekommendationer?
> AI:n analyserar systemet och rekommenderar justeringar fÃ¶r bÃ¤ttre effektivitet.

**Alert-meddelande format:**
```
âœ… Rekommendationer fÃ¶r COP-optimering

Rekommendationer:
â€¢ Offset (47011): -2.0 â†’ -2.5
  SÃ¤nk offset fÃ¶r att fÃ¶rbÃ¤ttra COP (nuvarande: 2.80)
  ğŸ“± Justera manuellt i vÃ¤rmepumpen: Meny 4.1.1

âš ï¸ MyUplink API stÃ¶djer inte automatisk justering...
```

#### 3. Quick Action: Optimera fÃ¶r komfort
**Confirm-dialog innan:**
> Optimera fÃ¶r maximal komfort?
> Detta justerar offset fÃ¶r att nÃ¥ 21Â°C inomhus.

**Confirm-dialog efter:**
> FÃ¥ komfortrekommendationer?
> AI:n analyserar och rekommenderar justeringar fÃ¶r att nÃ¥ 21Â°C inomhus.

**Alert-meddelande format:**
```
âœ… Rekommendation fÃ¶r komfort. Nuvarande temp: 20.5Â°C, mÃ¥l: 21Â°C

Rekommendationer:
â€¢ Offset (47011): -2 â†’ -1
  Justera offset fÃ¶r att nÃ¥ mÃ¥ltemperatur 21Â°C (nu 20.5Â°C)
  ğŸ“± Justera manuellt i vÃ¤rmepumpen: Meny 4.1.1
```

## JavaScript-Ã¤ndringar

### FrÃ¥n 'changes' till 'recommendations'
Uppdaterat alla quick action-funktioner fÃ¶r att hantera det nya API-formatet:

**Innan:**
```javascript
if (result.changes && result.changes.length > 0) {
    msg += '\n\nÃ„ndringar:';
    result.changes.forEach(c => {
        msg += `\nâ€¢ ${c.parameter}: ${c.old_value} â†’ ${c.new_value}`;
    });
}
```

**Efter:**
```javascript
if (result.recommendations && result.recommendations.length > 0) {
    msg += '\n\nRekommendationer:';
    result.recommendations.forEach(r => {
        msg += `\nâ€¢ ${r.parameter}: ${r.current_value} â†’ ${r.recommended_value}`;
        msg += `\n  ${r.reason}`;
        msg += `\n  ğŸ“± ${r.manual_adjustment}`;
    });
    if (result.note) {
        msg += `\n\nâš ï¸ ${result.note}`;
    }
}
```

## AnvÃ¤ndarupplevelse

### Innan uppdateringen
1. AnvÃ¤ndaren klickar "HÃ¶j temp" â†’ **FÃ¥r felmeddelande (404)**
2. Oklart varfÃ¶r det inte fungerar
3. FÃ¶rvirring om systemets funktionalitet

### Efter uppdateringen
1. AnvÃ¤ndaren klickar "HÃ¶j temp" â†’ **FÃ¥r tydlig rekommendation**
2. Ser nuvarande vÃ¤rde, rekommenderat vÃ¤rde och motivering
3. FÃ¥r exakt instruktion: "Justera manuellt i vÃ¤rmepumpen: Meny 4.1.1"
4. FÃ¶rstÃ¥r att MyUplink API har begrÃ¤nsningar
5. Har full kontroll Ã¶ver alla Ã¤ndringar

## Deployment

### Commits
1. `95a7f21` - Update UI to reflect advisory system model
2. `8c1a93f` - Fix MyUplink API compatibility and make recommendations advisory
3. `0e8dea8` - Add detailed changelog for MyUplink API compatibility fixes

### Deployed till Raspberry Pi
```bash
cd /home/peccz/nibe_autotuner
git pull
sudo systemctl restart nibe-mobile
```

### Service status
âœ… nibe-mobile.service kÃ¶rs pÃ¥ http://192.168.86.34:8502

## Kommunikation till anvÃ¤ndaren

### Tydliga budskap
1. **Systemet Ã¤r rÃ¥dgivande** - Automatiska justeringar Ã¤r inte mÃ¶jliga
2. **Gemini AI driver analysen** - Inte lÃ¤ngre Claude
3. **MyUplink API begrÃ¤nsning** - Transparant om varfÃ¶r det inte Ã¤r automatiskt
4. **Du har kontrollen** - AnvÃ¤ndaren beslutar om alla Ã¤ndringar
5. **Tydliga instruktioner** - Exakt var i vÃ¤rmepumpen justeringar gÃ¶rs

### Visuell hierarki
- ğŸŸ£ Lila banner = Viktig systeminformation
- âš ï¸ Varningssymbol = API-begrÃ¤nsning
- ğŸ“± Mobil-ikon = Manuell Ã¥tgÃ¤rd krÃ¤vs
- âœ… Checkmark = FramgÃ¥ngsrik AI-analys
- ğŸ’¬ Gemini chat = Alltid tillgÃ¤nglig fÃ¶r frÃ¥gor

## Sammanfattning

Systemet kommunicerar nu tydligt att det Ã¤r ett **intelligent rÃ¥dgivningssystem** som:
- âœ… Analyserar prestanda kontinuerligt
- âœ… Genererar smarta rekommendationer med Gemini AI
- âœ… FÃ¶rklarar varfÃ¶r Ã¤ndringar rekommenderas
- âœ… Ger exakta manuella justeringsinstruktioner
- âœ… LÃ¥ter anvÃ¤ndaren ha full kontroll

Detta Ã¤r faktiskt en **bÃ¤ttre anvÃ¤ndarupplevelse** Ã¤n automatiska justeringar:
- AnvÃ¤ndaren fÃ¶rstÃ¥r varje Ã¤ndring
- Ingen risk fÃ¶r oavsiktliga komfortproblem
- Full transparens om systemets funktionalitet
- Tydlig kommunikation om API-begrÃ¤nsningar

---

**URL:** http://192.168.86.34:8502/ai-agent
**Status:** âœ… Uppdaterat och deployat
